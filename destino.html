<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rotas Seguras</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Arial,sans-serif;background:#f0f0f0;display:flex;justify-content:center;align-items:center;min-height:100vh;}
    .container{width:100%;max-width:420px;height:100vh;background:#1a1a1a;display:flex;flex-direction:column;}
    .header{color:#fff;text-align:center;padding:16px;font-size:1.4rem;font-weight:bold;}
    .content-area{flex-grow:1;padding:12px;display:flex;flex-direction:column;gap:16px;}
    .input-box{background:#f9f9f9;padding:16px;border-radius:10px;box-shadow:0 2px 4px rgba(0,0,0,0.1);}
    .input-box span{font-size:0.9rem;color:#333;}
    .input-box input{width:100%;padding:10px;margin-top:8px;border:1px solid #ccc;border-radius:6px;font-size:0.95rem;}
    .save-buttons{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px;}
    .save-buttons button{flex:1 1 calc(50% - 8px);background:#7b0033;color:#fff;border:none;padding:10px;border-radius:6px;cursor:pointer;font-size:0.85rem;transition:0.3s;}
    .save-buttons button:hover{background:#5f0028;}
    .map-button{width:100%;background:#007bff;color:#fff;padding:12px;border:none;border-radius:6px;font-size:0.9rem;margin-top:12px;cursor:pointer;}
    .map-button:hover{background:#0056b3;}
    .map-container{flex-grow:1;border-radius:10px;overflow:hidden;box-shadow:0 2px 6px rgba(0,0,0,0.15);}
    #map{height:100%;width:100%;}
    .route-button{background:#7b0033;color:#fff;padding:16px;border:none;border-radius:10px;font-size:1.1rem;font-weight:bold;cursor:pointer;margin:16px;transition:0.3s;}
    .route-button:hover{background:#5f0028;}
    @media(min-width:600px){.container{max-width:500px;height:90vh;border-radius:16px;box-shadow:0 4px 10px rgba(0,0,0,0.2);}}
    @media(min-width:900px){.container{max-width:800px;height:85vh;flex-direction:row;overflow:hidden;}.content-area{flex:1;max-width:350px;padding:20px;}.map-container{flex:2;}.route-button{margin:20px 0;}}
</style>
</head>
<body>
<div class="container">
    <header class="header">Rotas Seguras</header>
    <div class="content-area">
        <div class="input-box">
            <span>Destino:</span>
            <input type="text" id="destinationInput" placeholder="Digite o endere√ßo de destino">
            <div class="save-buttons">
                <button onclick="saveAddress('home')">Salvar Casa</button>
                <button onclick="saveAddress('work')">Salvar Trabalho</button>
                <button onclick="loadAddress('home')">Casa</button>
                <button onclick="loadAddress('work')">Trabalho</button>
            </div>
            <button class="map-button" onclick="plotDestination()">Ver no Mapa</button>
        </div>
        <div class="map-container"><div id="map"></div></div>
        <button class="route-button" onclick="findRouteAndNavigate()">üöó Mostrar caminho seguro</button>
    </div>
</div>
<script>
const map = L.map('map').setView([-23.5505,-46.6333],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'¬© OpenStreetMap contributors'}).addTo(map);
let destinationMarker;
async function geocodeAddress(address){
    const url=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`;
    const data=await fetch(url).then(r=>r.json());
    if(!data.length) throw new Error('Endere√ßo n√£o encontrado');
    return [parseFloat(data[0].lat),parseFloat(data[0].lon)];
}
async function plotDestination(){
    const addr=document.getElementById('destinationInput').value;
    if(!addr){alert('Digite o destino');return;}
    try{
        const coords=await geocodeAddress(addr);
        if(destinationMarker) map.removeLayer(destinationMarker);
        destinationMarker=L.marker(coords,{draggable:true}).addTo(map).bindPopup('Arraste para corrigir').openPopup();
        map.setView(coords,16);
    }catch(e){alert(e.message);}
}
async function findRouteAndNavigate(){
    if(!destinationMarker){alert('Escolha o destino');return;}
    try{
        const startCoords=await new Promise((res,rej)=>navigator.geolocation.getCurrentPosition(p=>res([p.coords.latitude,p.coords.longitude]),err=>rej(err)));
        const endCoords=[destinationMarker.getLatLng().lat,destinationMarker.getLatLng().lng];
        localStorage.setItem('startCoords',JSON.stringify(startCoords));
        localStorage.setItem('endCoords',JSON.stringify(endCoords));
        window.location.href='rtas2.html';
    }catch(e){alert('Erro ao obter localiza√ß√£o');console.error(e);}
}
async function saveAddress(key){
    const addr=document.getElementById('destinationInput').value;
    if(!addr){alert('Digite um endere√ßo para salvar');return;}
    try{
        const coords=await geocodeAddress(addr);
        localStorage.setItem(key,JSON.stringify({address:addr,coords}));
        alert(`Endere√ßo "${key}" salvo!`);
    }catch(e){alert('Erro ao salvar endere√ßo');console.error(e);}
}
function loadAddress(key){
    const data=localStorage.getItem(key);
    if(data){document.getElementById('destinationInput').value=JSON.parse(data).address;plotDestination();}
    else alert(`Nenhum endere√ßo salvo para ${key}`);
}
</script>
</body>
</html>
